-- V1__create_card_tokens_table.sql
CREATE TABLE CARD_TOKENS (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  TOKEN VARCHAR2(64 CHAR) NOT NULL,
  PAN_HASH VARCHAR2(64 CHAR) NOT NULL,
  COLLISION_COUNTER NUMBER DEFAULT 0 NOT NULL,
  ENCRYPTED_PAN BLOB NOT NULL,
  NONCE RAW(12) NOT NULL,
  ENCRYPTED_DATA_KEY BLOB NOT NULL,
  AAD CLOB NULL,
  MERCHANT_ID VARCHAR2(100 CHAR) NULL,
  CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP,
  KEY_WRAP_VERSION VARCHAR2(256 CHAR) NULL,
  TOKEN_VERSION NUMBER DEFAULT 1,
  CONSTRAINT UX_TOKEN UNIQUE (TOKEN),
  CONSTRAINT UX_PAN_HASH UNIQUE (PAN_HASH)
);

-- V1__create_card_tokens_table.sql
CREATE TABLE CARD_TOKENS (
  ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
  TOKEN VARCHAR2(64 CHAR) NOT NULL,
  CC_NUMBER_HASH VARCHAR2(64 CHAR) NOT NULL,
  COLLISION_COUNTER NUMBER DEFAULT 0 NOT NULL,
  ENCRYPTED_CC_NUMBER BLOB NOT NULL,
  NONCE RAW(12) NOT NULL,
  ENCRYPTED_DATA_KEY BLOB NOT NULL,
  CREATED_AT TIMESTAMP WITH TIME ZONE DEFAULT SYSTIMESTAMP,
  KEY_WRAP_VERSION VARCHAR2(256 CHAR) NULL,
  TOKEN_VERSION NUMBER DEFAULT 1,
  CONSTRAINT UX_TOKEN UNIQUE (TOKEN),
  CONSTRAINT UX_CC_NUMBER_HASH UNIQUE (CC_NUMBER_HASH)
);
